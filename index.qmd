---
title: "The macroecology of knowledge: Spatio-temporal patterns of name-bearing types in biodiversity science"
format: html
eval: FALSE
date: 2024-07-24
author:
  - name: Gabriel Nakamura
    orcid: 0000-0002-5144-5312
  - name: Lívia Estéfane F. Frateles
    orcid: 0000-0003-0644-5425
  - name: Bruno H. Mioto Stabile
    orcid: 0000-0002-3524-537X
  - name: Matheus Lima de Araujo
    orcid: 0000-0002-9111-725X
  - name: Emanuel Neuhaus
    orcid: 0000-0002-5966-7585
  - name: Manoela Maria Ferreira Marinho
    orcid: 0000-0003-4226-666X
  - name: Melina de Souza Leite
    orcid: 0000-0003-0505-0667
  - name: Aline Richter
    orcid: 0000-0001-6385-153X
  - name: Liuyong Ding
    orcid: 0000-0002-5490-182X
  - name: Tiago Magalhães da Silva Freitas
    orcid: 0000-0003-3203-3408
  - name: Bruno Eleres Soares
    orcid: 0000-0001-5678-0403
  - name: Weferson Júnio da Graça
    orcid: 0000-0002-8925-5629
  - name: José Alexandre Felizola Diniz-Filho
    orcid: 0000-0002-0967-9684
---

::: callout-note
This manuscript is submitted as a preprint here: Link
:::

# General overview

This repository contains the data and code used in the analysis of the manuscript entitled **"The macroecology of knowledge: Spatio-temporal patterns of name-bearing types in biodiversity science"**.

In this study we characterized different aspects of spatial and temporal patterns of fish Name Bearing Types (NBT) among countries and world regions. The characteristics comprises the number of total NBT, the NBT flowing among different world regions, the characteristics of regions and countries regarding the source of NBT in their biological collection, the level of underepresentation of native species and the level of overepresentation of non-native species for each country.

We discuss how the fundamental knowledge in fish species is distributed and its implications for science development and knowledge sharing.

# Repository structure

## data

This folder stores raw and processed data used to perform all the analysis presented in this study

### raw

-   `flow_period_region_country.csv` a data frame in the long format containing the flowing of NBT per regions per per time (50-year time frame). Variables:

    -   `period` numeric variable representing 50-year time intervals

    -   `region_type` character representing the name of the World Bank region of the country where the NBT was sourced

    -   `country_type` character. A three letter code (alpha-3 ISO3166) representing the country of the museum where the NBT was sourced

    -   `region_museum` character. Name of the World Bank region of the country where the NBT is housed

    -   `country_museum` character. A three letter code (alpha-3 ISO3166) representing the country of the museum where the NBT is housed

    -   `n` numeric. The number of NBT flowing from one country to another

-   `spp_native_distribution.csv` data frame in the long format containing the native composition at the country level. Variables:

    -   `species` character. The name of a species in the format genus_epithet according to the Catalog of Fishes (including synonym names)

    -   `country_distribution` character. Three letter code (alpha-3 ISO3166) indicating the name of the country where a species is native to

    -   `region_distribution` character. The name of the region acording with World Bank where a species is native to

-   `spp_type_distribution.csv` data frame in the long format containing the composition of NBT by country. Variables:

    -   `species` character. The name of a species in the format genus_epithet according to the Catalog of Fishes (including synonym names)

    -   `country_distribution` character. Three letter code (alpha-3 ISO3166) indicating the name of the country where a species is housed

    -   `region_distribution` character. The name of the region acording with World Bank where a species is housed

-   `bio-dem_data.csv` data frame with data downloaded from [Bio-Dem](https://bio-dem.surge.sh/#awards) containing information on biological and social information at the country level. Variables:

    -   `country` character. A three letter code (alpha-3 ISO3166) representing a country

    -   `records` numeric. Total number of species occurrence records from Global Biodiverity Facility (GBIF)

    -   `records_per_area` numeric. Records per area from gbif

    -   `yearsSinceIndependence` numeric. Years since independence for each country

    -   `e_migdppc` numeric. GDP per capta

-   `museum_data.csv` data frame with museums' acronyms and the world region of each. Variables:

    -   `code_museum` character. The acronym (three letter code) of the museum

    -   `country_museum` character. A three letter code (alpha-3 ISO3166) representing a country

    -   `region_museum` character. The name of the region acording with World Bank

### processed

-   `flow_region.csv` a data frame containing flowing of NBT among world regions and the total number of NBT derived from the source region

-   `flow_period_region.csv` a data frame with the number of NBT between the world regions per 50-year time frame and the total number of NBT in each time frame for each world region

-   `flow_period_region_prop.csv` a data frame with the number of NBT, the Domestic Contribution and Domestic Retention between the world regions in a 50-year time frame

-   `flow_region_prop.csv` data with the total number of species flowing between world regions, Domestic Contribution and Domestic Retention

-   `flow_country.csv` data frame with flowing information of NBT among countries

-   `df_country_native.csv` data frame with the number of native species at the country level

-   `df_country_type.csv` data frame with the number of NBT at the country level

- `df_endemic_beta.csv` data frame with values of native and NBT turnover at the country level using only species with restricted occurrences at the country level

- `df_all_beta.csv` data frame with values of native and NBT turnover at the country level. This is used in the analysis of Supplementary material

## R

The letters `D`, `A` and `V` represents scripts for, respectively, data processing (D), data analysis (A) and results visualization (V). The script sequence to reproduce the workflow is indicated by the numbers at the beginning of the name of the script file.

![](scripts_diagram.png)

-   [`01_D_data_preparation.qmd`](R/01_D_data_preparation.qmd) initial data preparation

-   [`02_A_beta-countries.qmd`](R/02_A_beta-countries.qmd) analysis of beta diversity metrics. This script is used to calculate `turnover NBT` and `native NBT`

-   [`03_D_data_preparation_models.qmd`](R/03_D_data_preparation_models.qmd) script used to build data frames that will be used in statistical models ([`04_A_model_NBTs.qmd`](R/04_A_model_NBTs.qmd))

-   [`04_A_model_NBTs.qmd`](R/04_A_model_NBTs.qmd) statistical models for the total number of NBT, native and NBT turnover, Domestic Contribution and Domestic Retention

-   [`05_V_chord_diagram_Fig1.qmd`](R/05_V_chord_diagram_Fig1.qmd) code used to produce circular flow diagram. This is the Figure 1 of the study

-   [`06_V_world_map_Fig1.qmd`](R/06_V_world_map_Fig1.qmd) code used to produce the world map in the Figure 1 of the main text

-   [`07_V_scatterplot_Fig2.qmd`](R/07_V_scatterplot_Fig2.qmd) code used to reproduce the Figure 2 of the main text

-   [`08_V_beta_Fig3.qmd`](R/08_V_beta_Fig3.qmd) code used to build Figure 3 of the main text

-   [`09_V_model_Fig4.qmd`](R/09_V_model_Fig4.qmd) code used to build the Figure 4 of the main text. This is the representation of the results of the models present in the script [04_A_model_NBTs.qmd](R/04_A_model_NBTs.qmd)

-   [`0010_Supplementary_analysis.qmd`](R/0010_Supplementary_analysis.qmd) code to produce all the tables and figures presented in the Supplementary material of this study

-   [`0011_V_beta_all_FigS3.qmd`]() code to produce the Figure S3 in the supplementary material producing a cartogram with countries coloured accoridng to its native and NBT turnover values, considering all species

### functions

-   [`function_beta_types_success_fail.R`]() function used to calculate turnover metrics.

-   [`function_scale_back.R`]() function used to transform back normalized variables 

## output

### Figures

In this folder you will find all figures used in the main text and supplementary material of this study

`Fig1_flow_circle_plot.png` Figure with circular plots showing the flux of NBT among regions of the world in a 50-year time window

`Fig2_DC_DR.png` Scaterplot with World regions characterized by their Domestic Contribution and Domestic Retention values in a 50-year time frame

`Fig3_turnover_metrics.png` Cartogram with 3 maps showing the level of native turnover, NBT turnover and the combination of both metrics in a combined map

`Fig4_models.png` Figure showing the predictions of the number of NBT, DC, DR, native turnover and NBT turnover for different predictors. This is derived from the statistical models

#### Supp-material

This folder contains the figures in the Supplementary material

-   `FigS1_native_richness.png` World map with countries coloured according to the number of native species richness according to the Catalog of Fishes

-   `FigS2_scatterplot.png` All-time Domestic contribution (DC) and Domestic retention (DR) for world regions

## Packages

| Package       | Version      | Documentation                                                             |
|--------------|--------------|---------------------------------------------|
| bbmle         | 1.0.25.1     | [bbmle](https://cran.r-project.org/web/packages/bbmle/bbmle.pdf)          |
| betapart      | 1.6          | [betapart](https://cran.r-project.org/web/packages/betapart/betapart.pdf) |
| biscale       | 1.0.0        | [biscale](https://chris-prener.github.io/biscale/)                        |
| circlize      | 0.4.15       | [circlize](https://jokergoo.github.io/circlize_book/book/)                |
| countrycode   | 1.6.0        | [countrycode](https://vincentarelbundock.github.io/countrycode/#/)        |
| cowplot       | 1.1.1        | [cowplot](https://wilkelab.org/cowplot/)                                  |
| DHARMa        | 0.4.6        | [DHARMa](https://florianhartig.github.io/DHARMa/)                         |
| dplyr         | 1.1.4        | [dplyr](https://dplyr.tidyverse.org)                                      |
| ggarrow       | 0.0.0.9000   | [ggarrow](https://teunbrand.github.io/ggarrow/)                           |
| ggplot2       | 3.5.0        | [ggplot2](https://ggplot2.tidyverse.org)                                  |
| glmmTMB       | 1.1.8        | [glmmTMB](https://glmmtmb.github.io/glmmTMB/)                             |
| glue          | 1.6.2        | [glue](https://glue.tidyverse.org)                                        |
| here          | 1.0.1        | [here](https://here.r-lib.org)                                            |
| patchwork     | 1.2.0.9000   | [patchwork](https://patchwork.data-imaginist.com)                         |
| performance   | 0.12.1       | [performance](https://easystats.github.io/performance/)                   |
| phyloregion   | 1.0.8        | [phyloregion](https://phyloregion.com)                                    |
| readr         | 2.1.4        | [readr](https://readr.tidyverse.org)                                      |
| rmapshaper    | 0.5.0        | [rmapshaper](https://andyteucher.ca/rmapshaper/)                          |
| rnaturalearth | 0.3.4        | [rnaturalearth](https://ropensci.github.io/rnaturalearth/)                |
| scales        | 1.3.0.9000\* | [scales](https://scales.r-lib.org)                                        |
| sf            | 1.0-14       | [sf](https://r-spatial.github.io/sf/)                                     |
| tidyr         | 1.3.1        | [tidyr](https://tidyr.tidyverse.org)                                      |

\* Developer version

# Contact

[Gabriel Nakamura](https://github.com/GabrielNakamura) and [Bruno Mioto](https://github.com/brunomioto)

If you have any suggestion or commentary, please open an issue

[Source code](https://github.com/GabrielNakamura/NBT_code_data)

# Session Info

```{r}
sessionInfo()
#> R version 4.3.2 (2023-10-31 ucrt)
#> Platform: x86_64-w64-mingw32/x64 (64-bit)
#> Running under: Windows 10 x64 (build 19045)
#> 
#> Matrix products: default
#> 
#> 
#> locale:
#> [1] LC_COLLATE=Portuguese_Brazil.utf8  LC_CTYPE=Portuguese_Brazil.utf8   
#> [3] LC_MONETARY=Portuguese_Brazil.utf8 LC_NUMERIC=C                      
#> [5] LC_TIME=Portuguese_Brazil.utf8    
#> 
#> time zone: Etc/GMT+3
#> tzcode source: internal
#> 
#> attached base packages:
#> [1] stats4    stats     graphics  grDevices utils     datasets  methods  
#> [8] base     
#> 
#> other attached packages:
#>  [1] biscale_1.0.0        cowplot_1.1.1        patchwork_1.2.0.9000
#>  [4] ggarrow_0.0.0.9000   rmapshaper_0.5.0     sf_1.0-14           
#>  [7] rnaturalearth_0.3.4  circlize_0.4.15      DHARMa_0.4.6        
#> [10] bbmle_1.0.25.1       performance_0.12.1   glmmTMB_1.1.8       
#> [13] ggplot2_3.5.0        scales_1.3.0.9000    countrycode_1.6.0   
#> [16] phyloregion_1.0.8    readr_2.1.4          here_1.0.1          
#> [19] glue_1.6.2           tidyr_1.3.1          dplyr_1.1.4         
#> 
#> loaded via a namespace (and not attached):
#>  [1] DBI_1.1.3           phangorn_2.11.1     sandwich_3.0-2     
#>  [4] rlang_1.1.2         magrittr_2.0.3      multcomp_1.4-25    
#>  [7] predicts_0.1-11     e1071_1.7-13        compiler_4.3.2     
#> [10] mgcv_1.9-0          vctrs_0.6.4         quadprog_1.5-8     
#> [13] pkgconfig_2.0.3     shape_1.4.6         fastmap_1.1.1      
#> [16] clustMixType_0.3-9  utf8_1.2.4          rmarkdown_2.26     
#> [19] tzdb_0.4.0          nloptr_2.0.3        purrr_1.0.2        
#> [22] xfun_0.43           reprex_2.0.2        jsonlite_1.8.8     
#> [25] styler_1.10.2       terra_1.7-55        parallel_4.3.2     
#> [28] R6_2.5.1            RColorBrewer_1.1-3  boot_1.3-28.1      
#> [31] numDeriv_2016.8-1.1 estimability_1.4.1  Rcpp_1.0.11        
#> [34] knitr_1.46          zoo_1.8-12          R.utils_2.12.2     
#> [37] Matrix_1.6-2        splines_4.3.2       R.cache_0.16.0     
#> [40] igraph_2.0.3        tidyselect_1.2.1    rstudioapi_0.16.0  
#> [43] yaml_2.3.8          TMB_1.9.10          codetools_0.2-19   
#> [46] curl_5.1.0          lattice_0.22-5      tibble_3.2.1       
#> [49] withr_3.0.0         coda_0.19-4.1       evaluate_0.23      
#> [52] survival_3.5-7      units_0.8-4         proxy_0.4-27       
#> [55] pillar_1.9.0        KernSmooth_2.23-22  smoothr_1.0.1      
#> [58] insight_0.20.2      generics_0.1.3      rprojroot_2.0.4    
#> [61] sp_2.1-3            maptpx_1.9-7        hms_1.1.3          
#> [64] munsell_0.5.0       minqa_1.2.6         xtable_1.8-4       
#> [67] class_7.3-22        slam_0.1-50         emmeans_1.8.9      
#> [70] tools_4.3.2         lme4_1.1-35.1       fs_1.6.3           
#> [73] mvtnorm_1.2-3       fastmatch_1.1-4     grid_4.3.2         
#> [76] ape_5.8             bdsmatrix_1.3-6     colorspace_2.1-0   
#> [79] nlme_3.1-163        cli_3.6.1           fansi_1.0.6        
#> [82] V8_4.4.0            gtable_0.3.4        R.methodsS3_1.8.2  
#> [85] digest_0.6.33       classInt_0.4-10     TH.data_1.1-2      
#> [88] htmltools_0.5.8.1   R.oo_1.25.0         lifecycle_1.0.4    
#> [91] httr_1.4.7          GlobalOptions_0.1.2 MASS_7.3-60
```
