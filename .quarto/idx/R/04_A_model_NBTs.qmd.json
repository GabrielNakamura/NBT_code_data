{"title":"04 - Modelling different aspects of countries regarding NBT characteristics","markdown":{"yaml":{"title":"04 - Modelling different aspects of countries regarding NBT characteristics","format":"html","eval":false},"headingText":"General overview","containsRefs":false,"markdown":"\n\n\nHere we provided the code used to model the total number of NBT, \n    Domestic Contribution (DC), Domestic Retention (DR), Native turnover\n    and NBT turnover. These models are represented in Figures 4 in the main text,\n    Figure S3 and S4, and tables S1, S2 and S3 in Supplementary material.\n\n# Reading libraries\n\n```{r}\n# data\nlibrary(dplyr)       # data manipulation\nlibrary(readr)       # read CSV files\nlibrary(here)        # file paths handling\n\n# plot\nlibrary(scales)      # data transformation functions\nlibrary(ggplot2)     # data visualization\n\n# model\nlibrary(glmmTMB)     # generalized Linear Mixed Models\nlibrary(performance) # model performance checks\nlibrary(bbmle)       # model selection and AIC calculations\nlibrary(DHARMa)      # model diagnostics and residuals simulation\n```\n\n# Previous data used\n\n```{r}\n# Data from 02_C_data_preparation_models.qmd\ndf_country_complete6 <- readr::read_csv(here::here(\"data\", \"processed\", \"df_country_complete6.csv\"))\n```\nSome auxiliary function used to plot the results\n\n```{r}\nsqrt_trans <- scales::trans_new(\"sqrt_with_zero\", \n                        transform = function(x) ifelse(x == 0, 0, sqrt(x)),\n                        inverse = function(x) x^2)\n\n# dummy data\nplot_data <- data.frame(x = 0:10,\n                        y = 0:10)\n```\n\n# Modelling primary type distribution with biological and sociological/economic/political variables\n\nIn the modelling approach we used four response variables: \n\n- The total number of NBTs owned by a country `total_country_museum`\n\n- The proportion of Domestic Contribution by a country `prop_DC` and `success.DC`\n\n- The proportion of Domestic Retention by a country `prop_DR` and `success.DR`\n\n- The rate of native underrepresentation by a country `native.beta`\n\n- The rate of type overrepresentation by a country `type.beta`\n\nAll these variables are used in a country level (i.e. each point in the figures\n    corresponds to a country)\n\n\n# Data and Models\n\n## Total number of NBT by country\n\nAfter standardize the variables we can fit the models. Since we have a huge amount\n    of zeroes in our response variable we will use a zero-inflation poisson model\n    and also test with a poisson distribution.\n\n```{r}\nggplot(df_country_complete6, aes(type.richness.pad)) +\n  geom_density(alpha = 0.4, fill = \"darkorange\")\n```\n\nFitting different models to check which one is the most appropriate\n\n```{r}\nmod_pois <-\n  glmmTMB::glmmTMB(type.richness.pad ~ native.richness.pad + \n                     records.per.area.pad + years.independence.pad + \n                     gdp.pad + n.museums.pad, zi = ~., \n                   data = df_country_complete6, \n                   family = poisson) # poisson\n\nmod_zero_pois <-\n  glmmTMB::glmmTMB(type.richness.pad ~ native.richness.pad + \n                     records.per.area.pad + years.independence.pad + \n                     gdp.pad + n.museums.pad, zi = ~., \n                   data = df_country_complete6, \n                   family = glmmTMB::nbinom2) # negative binomial\n\nmod_hurdle <-\n  glmmTMB::glmmTMB(type.richness.pad ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad,\n                   zi = ~.,\n                   data = df_country_complete6,\n                   family = glmmTMB::truncated_nbinom2)\n\nsummary(mod_hurdle)\nperformance::check_zeroinflation(mod_hurdle)\nsummary(mod_zero_pois)\nperformance::check_zeroinflation(mod_zero_pois)\n\n## model selection\nbbmle::ICtab(mod_pois, mod_zero_pois, mod_hurdle)\n\n# checking homocedasticity \nDHARMa::simulateResiduals(fittedModel = mod_zero_pois, plot = T)\nDHARMa::simulateResiduals(fittedModel = mod_hurdle, plot = T)\n\nperformance::check_collinearity(mod_zero_pois)\n# Exporting best model\n\nsaveRDS(mod_zero_pois, here::here(\"output\", \"models\", \"model_res_counting.rds\"))\n\n```\n\n## Modelling native and NBT turnover\n\nIn this section we will model the two turnover metrics that represent the deficit of native species in biological collections of a given country and the overrepresentation of primary types regarding the native fish fauna of a given country. These variables are `native.beta` and `type.beta`.\n\n\n```{r}\nmod_native_turnover <-\n  glmmTMB::glmmTMB(native.beta.model ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, \n                   family = glmmTMB::beta_family,\n                   data = df_country_complete6)\n\n\nmod_type_turnover <-\n  glmmTMB::glmmTMB(type.beta.model ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, \n                   family = glmmTMB::beta_family,\n                   data = df_country_complete6)\n\n\n## Diagnose plots\nsummary(mod_native_turnover)\nsummary(mod_type_turnover)\n\nDHARMa::simulateResiduals(fittedModel = mod_native_turnover, plot = TRUE)\nDHARMa::simulateResiduals(fittedModel = mod_type_turnover, plot = TRUE)\nperformance::check_collinearity(mod_native_turnover)\nperformance::check_collinearity(mod_type_turnover)\n\n# Saving models\n\nsaveRDS(mod_native_turnover, here::here(\"output\", \"models\", \"model_res_turnover_native.rds\"))\nsaveRDS(mod_type_turnover, here::here(\"output\", \"models\", \"model_res_turnover_nbt.rds\"))\n\n```\n\n## Modelling country characteristics based on biological collections (Domestic Contribution and Domestic Retention)\n\nModel with a binomial distribution with success and failures using the raw data used to calculate Domestic Contribution (DC) and Domestic Retention (DR)\n\n\n```{r}\nmod_beta_dc_binom <-\n  glmmTMB::glmmTMB(cbind(success.DC, failures.DC) ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, ziformula = ~.,\n                   family = glmmTMB::betabinomial, \n                   data = df_country_complete6)\n\nDHARMa::simulateResiduals(fittedModel = mod_beta_dc_binom, plot = TRUE)\nsummary(mod_beta_dc_binom)\nperformance::check_collinearity(mod_beta_dc_binom)\n\nmod_beta_dr_binom <-\n  glmmTMB::glmmTMB(cbind(success.DR, failures.DR) ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, ziformula = ~., \n                   family = glmmTMB::betabinomial, \n                   data = df_country_complete6)\n\nDHARMa::simulateResiduals(fittedModel = mod_beta_dr_binom, \n                          plot = TRUE)\nsummary(mod_beta_dr_binom)\nperformance::check_collinearity(mod_beta_dr_binom)\n\n# saving results\nsaveRDS(mod_beta_dc_binom, \n        here::here(\"output\", \"models\", \"model_res_dc.rds\"))\nsaveRDS(mod_beta_dr_binom, \n        here::here(\"output\", \"models\", \"model_res_dr.rds\"))\n\n```\n\n\n","srcMarkdownNoYaml":"\n\n# General overview\n\nHere we provided the code used to model the total number of NBT, \n    Domestic Contribution (DC), Domestic Retention (DR), Native turnover\n    and NBT turnover. These models are represented in Figures 4 in the main text,\n    Figure S3 and S4, and tables S1, S2 and S3 in Supplementary material.\n\n# Reading libraries\n\n```{r}\n# data\nlibrary(dplyr)       # data manipulation\nlibrary(readr)       # read CSV files\nlibrary(here)        # file paths handling\n\n# plot\nlibrary(scales)      # data transformation functions\nlibrary(ggplot2)     # data visualization\n\n# model\nlibrary(glmmTMB)     # generalized Linear Mixed Models\nlibrary(performance) # model performance checks\nlibrary(bbmle)       # model selection and AIC calculations\nlibrary(DHARMa)      # model diagnostics and residuals simulation\n```\n\n# Previous data used\n\n```{r}\n# Data from 02_C_data_preparation_models.qmd\ndf_country_complete6 <- readr::read_csv(here::here(\"data\", \"processed\", \"df_country_complete6.csv\"))\n```\nSome auxiliary function used to plot the results\n\n```{r}\nsqrt_trans <- scales::trans_new(\"sqrt_with_zero\", \n                        transform = function(x) ifelse(x == 0, 0, sqrt(x)),\n                        inverse = function(x) x^2)\n\n# dummy data\nplot_data <- data.frame(x = 0:10,\n                        y = 0:10)\n```\n\n# Modelling primary type distribution with biological and sociological/economic/political variables\n\nIn the modelling approach we used four response variables: \n\n- The total number of NBTs owned by a country `total_country_museum`\n\n- The proportion of Domestic Contribution by a country `prop_DC` and `success.DC`\n\n- The proportion of Domestic Retention by a country `prop_DR` and `success.DR`\n\n- The rate of native underrepresentation by a country `native.beta`\n\n- The rate of type overrepresentation by a country `type.beta`\n\nAll these variables are used in a country level (i.e. each point in the figures\n    corresponds to a country)\n\n\n# Data and Models\n\n## Total number of NBT by country\n\nAfter standardize the variables we can fit the models. Since we have a huge amount\n    of zeroes in our response variable we will use a zero-inflation poisson model\n    and also test with a poisson distribution.\n\n```{r}\nggplot(df_country_complete6, aes(type.richness.pad)) +\n  geom_density(alpha = 0.4, fill = \"darkorange\")\n```\n\nFitting different models to check which one is the most appropriate\n\n```{r}\nmod_pois <-\n  glmmTMB::glmmTMB(type.richness.pad ~ native.richness.pad + \n                     records.per.area.pad + years.independence.pad + \n                     gdp.pad + n.museums.pad, zi = ~., \n                   data = df_country_complete6, \n                   family = poisson) # poisson\n\nmod_zero_pois <-\n  glmmTMB::glmmTMB(type.richness.pad ~ native.richness.pad + \n                     records.per.area.pad + years.independence.pad + \n                     gdp.pad + n.museums.pad, zi = ~., \n                   data = df_country_complete6, \n                   family = glmmTMB::nbinom2) # negative binomial\n\nmod_hurdle <-\n  glmmTMB::glmmTMB(type.richness.pad ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad,\n                   zi = ~.,\n                   data = df_country_complete6,\n                   family = glmmTMB::truncated_nbinom2)\n\nsummary(mod_hurdle)\nperformance::check_zeroinflation(mod_hurdle)\nsummary(mod_zero_pois)\nperformance::check_zeroinflation(mod_zero_pois)\n\n## model selection\nbbmle::ICtab(mod_pois, mod_zero_pois, mod_hurdle)\n\n# checking homocedasticity \nDHARMa::simulateResiduals(fittedModel = mod_zero_pois, plot = T)\nDHARMa::simulateResiduals(fittedModel = mod_hurdle, plot = T)\n\nperformance::check_collinearity(mod_zero_pois)\n# Exporting best model\n\nsaveRDS(mod_zero_pois, here::here(\"output\", \"models\", \"model_res_counting.rds\"))\n\n```\n\n## Modelling native and NBT turnover\n\nIn this section we will model the two turnover metrics that represent the deficit of native species in biological collections of a given country and the overrepresentation of primary types regarding the native fish fauna of a given country. These variables are `native.beta` and `type.beta`.\n\n\n```{r}\nmod_native_turnover <-\n  glmmTMB::glmmTMB(native.beta.model ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, \n                   family = glmmTMB::beta_family,\n                   data = df_country_complete6)\n\n\nmod_type_turnover <-\n  glmmTMB::glmmTMB(type.beta.model ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, \n                   family = glmmTMB::beta_family,\n                   data = df_country_complete6)\n\n\n## Diagnose plots\nsummary(mod_native_turnover)\nsummary(mod_type_turnover)\n\nDHARMa::simulateResiduals(fittedModel = mod_native_turnover, plot = TRUE)\nDHARMa::simulateResiduals(fittedModel = mod_type_turnover, plot = TRUE)\nperformance::check_collinearity(mod_native_turnover)\nperformance::check_collinearity(mod_type_turnover)\n\n# Saving models\n\nsaveRDS(mod_native_turnover, here::here(\"output\", \"models\", \"model_res_turnover_native.rds\"))\nsaveRDS(mod_type_turnover, here::here(\"output\", \"models\", \"model_res_turnover_nbt.rds\"))\n\n```\n\n## Modelling country characteristics based on biological collections (Domestic Contribution and Domestic Retention)\n\nModel with a binomial distribution with success and failures using the raw data used to calculate Domestic Contribution (DC) and Domestic Retention (DR)\n\n\n```{r}\nmod_beta_dc_binom <-\n  glmmTMB::glmmTMB(cbind(success.DC, failures.DC) ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, ziformula = ~.,\n                   family = glmmTMB::betabinomial, \n                   data = df_country_complete6)\n\nDHARMa::simulateResiduals(fittedModel = mod_beta_dc_binom, plot = TRUE)\nsummary(mod_beta_dc_binom)\nperformance::check_collinearity(mod_beta_dc_binom)\n\nmod_beta_dr_binom <-\n  glmmTMB::glmmTMB(cbind(success.DR, failures.DR) ~ native.richness.pad +\n                     records.per.area.pad + years.independence.pad +\n                     gdp.pad + n.museums.pad, ziformula = ~., \n                   family = glmmTMB::betabinomial, \n                   data = df_country_complete6)\n\nDHARMa::simulateResiduals(fittedModel = mod_beta_dr_binom, \n                          plot = TRUE)\nsummary(mod_beta_dr_binom)\nperformance::check_collinearity(mod_beta_dr_binom)\n\n# saving results\nsaveRDS(mod_beta_dc_binom, \n        here::here(\"output\", \"models\", \"model_res_dc.rds\"))\nsaveRDS(mod_beta_dr_binom, \n        here::here(\"output\", \"models\", \"model_res_dr.rds\"))\n\n```\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"04_A_model_NBTs.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.549","theme":"cosmo","code-links":[{"text":"Source Code","icon":"file-code","href":"https://github.com/GabrielNakamura/NBT_code_data"}],"title":"04 - Modelling different aspects of countries regarding NBT characteristics"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}