{"title":"02 - Analysis of mismatch between country native composition and primary type data","markdown":{"yaml":{"title":"02 - Analysis of mismatch between country native composition and primary type data","format":"html","eval":false},"headingText":"Reading packages","containsRefs":false,"markdown":"\n\n\n```{r packages}\n# data\nlibrary(readr)        # reading CSV files\nlibrary(here)         # constructing file paths\nlibrary(dplyr)        # data manipulation\nlibrary(tidyr)        # data tidying\nlibrary(phyloregion)  # handling phylogenetic data and transformations\n```\n\n# Importing and processing data \n\nImporting and processing native composition and NBT composition data\n\n```{r}\n# From 01_C_data_preparation.qmd\nspp_native_distribution <- readr::read_csv(here::here(\"data\", \"raw\", \"spp_native_distribution.csv\")) \n\n# From 01_C_data_preparation.qmd\nspp_type_distribution <- readr::read_csv(here::here(\"data\", \"raw\", \"spp_type_distribution.csv\")) \n```\n\nChecking the specimens with data in both tables (native distribution and types). We transformed the long format species occurrence data frame to dense format. During this procedure we removed 1204 species that do not have information on native distribution (or we couldn't get this information from CAS)\n\n```{r}\ndf_native_grid <- \n  spp_native_distribution |> \n  dplyr::select(grids = country_distribution, \n                species = valid_name) |> \n  tidyr::drop_na(grids)\n\ndf_type_grid <- \n  spp_type_distribution |> \n  dplyr::select(grids = country_museum, \n                species = valid_name) |> \n  tidyr::drop_na(grids) |> \n  dplyr::mutate(grids = paste(grids, \"type\", sep = \"_\"))\n  \n\n# joining data frames\ndf_all_grid <- rbind(df_native_grid, df_type_grid) # joining both matrices - \n    #native and types composition\n\n#### Just descriptive quantities\ncountry_native <- unique(df_native_grid$grids)\ncountry_type <- gsub(pattern = \"_type\", \n                     replacement = \"\",\n                     unique(df_type_grid$grids))\ncountry_type_zero <- setdiff(country_native, country_type) # countries with no type specimen\n\n# transforming into a sparse matrix to speed up calculations\nsparse_all <- df_all_grid |> \n  phyloregion::long2sparse(grids = \"grids\", species = \"species\") |> \n  phyloregion::sparse2dense()\n\n# Transforming in presence absence matrix\nsparse_all_pa <- ifelse(sparse_all >= 1, 1, 0) \n\n# Binding countries with no types - adding zeroes\ncountry_type_zero_names <- paste(country_type_zero, \"_type\", sep = \"\") # this will be used to bind together matrix with types and add the countries with no type\nmatrix_type_zero <- matrix(0,\n         nrow = length(country_type_zero_names),\n         ncol = ncol(sparse_all_pa), \n         dimnames = list(country_type_zero_names, \n                         colnames(sparse_all_pa)))\n\nsparse_all_pa2 <- rbind(sparse_all_pa, matrix_type_zero)\n\n```\n\n# Calculating directional turnover based on native and primary type comparison\n\nHere we calculated the turnover in two directions. One is the turnover of native composition, in other words, the underrepresentation of native fish species in museums and natural collections within the country. Values closer to one indicate that the country present a huge underepresentation of its native fish fauna in primary types located within the country. \n\nThe other metric is primary type turnover. Values approaching one indicate that there is an overepresentation of primary types maintained in the country when compared to the native fish fauna of that country.\n\n```{r}\nsource(here::here(\"R\", \"functions\", \"function_beta_types.R\"))\n\nnames_countries <- unique(df_native_grid$grids) # country names\n\ndf_all_beta <- beta_types(presab = sparse_all_pa2, \n                          names.countries = names_countries) # calculating metrics of directional turnover\n\nreadr::write_csv(df_all_beta, here::here(\"data\", \"processed\", \"df_all_beta.csv\"))\n```\n\n","srcMarkdownNoYaml":"\n\n# Reading packages\n\n```{r packages}\n# data\nlibrary(readr)        # reading CSV files\nlibrary(here)         # constructing file paths\nlibrary(dplyr)        # data manipulation\nlibrary(tidyr)        # data tidying\nlibrary(phyloregion)  # handling phylogenetic data and transformations\n```\n\n# Importing and processing data \n\nImporting and processing native composition and NBT composition data\n\n```{r}\n# From 01_C_data_preparation.qmd\nspp_native_distribution <- readr::read_csv(here::here(\"data\", \"raw\", \"spp_native_distribution.csv\")) \n\n# From 01_C_data_preparation.qmd\nspp_type_distribution <- readr::read_csv(here::here(\"data\", \"raw\", \"spp_type_distribution.csv\")) \n```\n\nChecking the specimens with data in both tables (native distribution and types). We transformed the long format species occurrence data frame to dense format. During this procedure we removed 1204 species that do not have information on native distribution (or we couldn't get this information from CAS)\n\n```{r}\ndf_native_grid <- \n  spp_native_distribution |> \n  dplyr::select(grids = country_distribution, \n                species = valid_name) |> \n  tidyr::drop_na(grids)\n\ndf_type_grid <- \n  spp_type_distribution |> \n  dplyr::select(grids = country_museum, \n                species = valid_name) |> \n  tidyr::drop_na(grids) |> \n  dplyr::mutate(grids = paste(grids, \"type\", sep = \"_\"))\n  \n\n# joining data frames\ndf_all_grid <- rbind(df_native_grid, df_type_grid) # joining both matrices - \n    #native and types composition\n\n#### Just descriptive quantities\ncountry_native <- unique(df_native_grid$grids)\ncountry_type <- gsub(pattern = \"_type\", \n                     replacement = \"\",\n                     unique(df_type_grid$grids))\ncountry_type_zero <- setdiff(country_native, country_type) # countries with no type specimen\n\n# transforming into a sparse matrix to speed up calculations\nsparse_all <- df_all_grid |> \n  phyloregion::long2sparse(grids = \"grids\", species = \"species\") |> \n  phyloregion::sparse2dense()\n\n# Transforming in presence absence matrix\nsparse_all_pa <- ifelse(sparse_all >= 1, 1, 0) \n\n# Binding countries with no types - adding zeroes\ncountry_type_zero_names <- paste(country_type_zero, \"_type\", sep = \"\") # this will be used to bind together matrix with types and add the countries with no type\nmatrix_type_zero <- matrix(0,\n         nrow = length(country_type_zero_names),\n         ncol = ncol(sparse_all_pa), \n         dimnames = list(country_type_zero_names, \n                         colnames(sparse_all_pa)))\n\nsparse_all_pa2 <- rbind(sparse_all_pa, matrix_type_zero)\n\n```\n\n# Calculating directional turnover based on native and primary type comparison\n\nHere we calculated the turnover in two directions. One is the turnover of native composition, in other words, the underrepresentation of native fish species in museums and natural collections within the country. Values closer to one indicate that the country present a huge underepresentation of its native fish fauna in primary types located within the country. \n\nThe other metric is primary type turnover. Values approaching one indicate that there is an overepresentation of primary types maintained in the country when compared to the native fish fauna of that country.\n\n```{r}\nsource(here::here(\"R\", \"functions\", \"function_beta_types.R\"))\n\nnames_countries <- unique(df_native_grid$grids) # country names\n\ndf_all_beta <- beta_types(presab = sparse_all_pa2, \n                          names.countries = names_countries) # calculating metrics of directional turnover\n\nreadr::write_csv(df_all_beta, here::here(\"data\", \"processed\", \"df_all_beta.csv\"))\n```\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"02_A_beta-countries.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.549","theme":"cosmo","code-links":[{"text":"Source Code","icon":"file-code","repo":"https://github.com/GabrielNakamura/NBT_code_data"}],"title":"02 - Analysis of mismatch between country native composition and primary type data"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}